"use client";

import React, { useEffect } from "react";
import { useRouter } from "next/navigation";
import { useAuth } from "~/hooks/useAuth";
import FahndungWizardContainer from "~/components/fahndungen/FahndungWizardContainer";
import { LoadingSpinner } from "~/components/ui/LoadingSpinner";

export default function EnhancedNeueFahndungPage() {
  const router = useRouter();
  const { session, loading, initialized } = useAuth();

  useEffect(() => {
    // Warte bis Auth initialisiert ist
    if (!initialized || loading) return;

    // Keine Session = Login
    if (!session) {
      console.log("🔐 Keine Session - Weiterleitung zu Login");
      router.push("/login");
      return;
    }

    // Prüfe Admin/Super-Admin Rechte
    const role = session.profile?.role;
    if (role !== "admin" && role !== "super_admin") {
      console.log("❌ Unzureichende Rechte - nur Admin/Super-Admin erlaubt");
      router.push("/dashboard?error=insufficient_permissions");
      return;
    }
  }, [session, loading, initialized, router]);

  // Loading State
  if (!initialized || loading) {
    return (
      <div className="min-h-screen bg-gray-50 dark:bg-gray-900">
        <div className="flex h-screen items-center justify-center">
          <LoadingSpinner message="Prüfe Berechtigungen..." />
        </div>
      </div>
    );
  }

  // Keine Session oder unzureichende Rechte
  if (!session || (session.profile?.role !== "admin" && session.profile?.role !== "super_admin")) {
    return (
      <div className="min-h-screen bg-gray-50 dark:bg-gray-900">
        <div className="flex h-screen items-center justify-center">
          <div className="text-center">
            <div className="mb-4 text-4xl">🔐</div>
            <div className="text-xl font-semibold">Zugriff verweigert</div>
            <div className="mt-2 text-gray-400">Weiterleitung...</div>
          </div>
        </div>
      </div>
    );
  }

  // Berechtigungen OK - Zeige Wizard
  return (
    <FahndungWizardContainer
      mode="create"
      title="Neue Fahndung erstellen"
      description="Erstellen Sie eine neue Fahndung mit unserem erweiterten Wizard"
    />
  );
}